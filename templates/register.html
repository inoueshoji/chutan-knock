@app.route("/register", methods=["GET", "POST"])
def register():
    if request.method == "POST":
        username = request.form["username"]
        password = request.form["password"]

        # ★ ユーザー名空白チェック
        if username.strip() == "":
            return render_template("register.html", error="ユーザー名を入力してください")

        # ★ パスワード空白チェック
        if password.strip() == "":
            return render_template("register.html", error="パスワードを入力してください")

        pw_hash = generate_password_hash(password)

        conn = sqlite3.connect("chutan.db")
        cur = conn.cursor()

        try:
            cur.execute("INSERT INTO users (username, password_hash) VALUES (?, ?)",
                        (username, pw_hash))
            conn.commit()

        except sqlite3.IntegrityError:
            conn.close()
            return render_template("register.html", error="すでに存在するユーザー名です")

        conn.close()
        return redirect(url_for("login"))

    return render_template("register.html")
